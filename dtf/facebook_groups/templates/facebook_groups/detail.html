{% extends "facebook_groups/list.html" %}
{% load staticfiles comments i18n %}
{% block title %}{{ facebook_group.name }}{{ block.super }}{% endblock title %}

{% block page_title %}{{ facebook_group.name }}{% endblock page_title %}

{% block group_actions %}
{{ block.super }}
<li><a href="{% url 'facebook_groups:feed_post' facebook_group.fb_uid %}"><i class="fa fa-plus"></i> Post</a></li>
{% endblock group_actions %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'facebook_groups/css/feed.css' %}">
{% endblock css %}

{% block feed %}
<section class="facebook-feed">
	<div class="container">
		<div class="col-md-7 col-md-offset-2">
			<p class="lead">{{ facebook_group.description }}</p>
			<div class="clearfix"></div>
			<div id="facebook-feed-list">
				{% get_comment_list for facebook_group as comment_list %}
				{% for comment in comment_list %}
					<div id="post-{{ comment.id }}" class="fb-post panel panel-default">
						<h3 class="fb-post-heading">
							<img src="{{ comment.user.get_fb_profile_img_url }}" class="fb-profile-img">
							<span class="fb-from-user">{{ comment.user.get_full_name }}</span>
							<small class="date">{{ comment.submit_date|date }}</small>
						</h3>
						<div class="panel-body">
							<p>{{ comment.comment }}</p>
						</div>
						<div class="panel-footer">

						{% render_comment_list for comment %}

					    {% if user.is_authenticated %}
					    {% get_comment_form for comment as form %}
						<form class="form fb-comment-form" action="{% comment_form_target %}" method="POST" data-access-token="{{ request.user.get_fb_access_token }}">
							{% csrf_token %}
							<div class="hidden">{{ form.honeypot }}</div>
							{{ form.content_type }}
							{{ form.object_pk }}
						    {{ form.timestamp }}
						    {{ form.security_hash }}
						    <input type="hidden" name="next" value="{% url 'facebook_groups:detail' facebook_group.fb_uid %}" />
						    <div class="">
						        <div class="row">
						            <div class="col-xs-2 col-sm-1 fb-profile-comment-img">
						                <img src="{{ request.user.get_fb_profile_img_url }}" class="img-responsive">
						            </div>
						            <div class="col-xs-10 col-sm-11">
						            	<div class="input-group">
							                <input type="text" class="form-control" placeholder="Write a comment..." name="comment" id="id_comment">
							                <span class="input-group-btn">
							                	<button type="submit" id="id_submit" class="btn btn-primary"/><i class="fa fa-send fa-fw"></i></button>
							                </span>
							            </div>
						            </div>
						        </div>
						    </div>
						</form>
						{% else %}
						    <p>Please <a href="{% url 'account_login' %}">log in</a> to leave a comment.</p>
						{% endif %}
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
</section>
{% endblock %}