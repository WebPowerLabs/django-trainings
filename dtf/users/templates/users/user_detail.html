{% extends "users/base.html" %}
{% load staticfiles i18n avatar_tags %}

{% block title %}{{ object.username }} | Decide to Fly{% endblock %}

{% block content %}

<div class="container">
    <h1 class="page-header">
      {{ object.first_name }}
    </h1>
  <div class="panel panel-default">
    <div class="panel-heading">
      Profile
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-3">
          {% if request.user == object %}
            <a class="" href="{% url 'avatar_add' %}">
          {% else %}
            <a>
          {% endif %}
          {% if object.fb_uid and not object|has_avatar %}
            <img src="{{ object.get_fb_profile_img_url }}" class="img-circle img-responsive">
          {% else %}
          <img src="{% avatar_url object 160 %}" class="img-circle img-responsive">
          {% endif %}
            </a>
        </div>
        <div class="col-md-9">
          <p><strong>My Archetype: </strong>{{ profile.archetype }}</p>
          <p><strong>My Anthem: </strong>{{ profile.anthem }}</p>
          <p><strong>I am ... </strong>{{ profile.about }} </p>
        </div>
      </div>
    </div>
    {% if request.user == object %}
    <div class="panel-footer">
      <a class="btn btn-link" href="{% url 'profiles:update_user_profile' %}">Update Profile</a>
    </div>
    {% endif %}
  </div>
</div>

{% if request.user == object or request.user.is_staff %}
<section class="dashboard">
  <div class="container">
    <h2 class="page-header">
      My Dashboard
    </h2>
    {% if etfar_form %}
    <div class="panel panel-primary">
      <div class="panel-heading">
        Navigation Tool
      </div>
      <div class="panel-body">
        {% include 'etfars/tool_isolate.html' %}
      </div>
    </div>
    {% endif %}


    <div class="row">
      <div class="col-md-7">
        <div class="panel panel-primary">
          <div class="panel-heading">
            Communities Feed
          </div>
          <div class="feed">
            {% for comment in comments %}
            <div class="fb-post">
              {% with comment.content_object as facebook_group %}
              {% include "features/comment.html" with hide_comments=False show_from=True next=request.user.get_absolute_url %}
              {% endwith %}
            </div>
            {% empty %}
            <div class="panel-body">
              <p>Your community feed will appear here when you <a href="{% url 'facebook_groups:list' %}">join a community</a>.</p>
            </div>
            {% endfor %}
          </div>
          {% if comments.paginator.num_pages > 1 %}
          <div class="panel-footer">
            {% include "comments/pager.html" with comment_list=comments %}
          </div>
          {% endif %}
        </div>
      </div>
      <div class="col-md-5">
        <div class="panel panel-primary">
          <div class="panel-heading">
            My Private Profile
          </div>
          <div class="panel-body">
              <form class="form form-horizontal" action="{% url 'profiles:update_user_private_profile' %}" method="POST">
                {% csrf_token %}
              {{ private_profile }}
              <input type="submit" class="btn btn-primary" value="Save">
              </form>
          </div>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            <a href="{% url 'journals:entries' %}" title="View My Journal" style="color:#fff;text-decoration:underline;">My Journal</a>
          </div>
          <div class="panel-body">
            {% if journal.can_submit %}
            <form class="form" action="{% url 'journals:entries' %}" method="POST">
              {% csrf_token %}
            {% for question in questions %}
              {% include "journals/journal_question.html" %}
              {% if forloop.last %}
              <input type="hidden" name="next" id="id_next" value="{% url 'users:detail' request.user.id %}">
              <input class="btn btn-primary" type="submit" value="Submit">
              {% endif %}
            {% empty %}
              <p>Your journal questions will appear here.</p>
            {% endfor %}
            
            </form>
            {% else %}
            <form class="form" action="{% url 'journals:entries_edit' entry.pk %}" method="POST">
              {% csrf_token %}
            {% for question, response in entry.data.iteritems %}
            <div id="div_id_{{ question }}" class="form-group">
              <label for="id_{{ question }}" class="control-label">{{ question }}</label>
              <div class="controls">
                <input class="textinput form-control" id="id_{{ question }}" maxlength="255" name="{{ question }}" type="text" value="{{ response }}"> 
              </div>
            </div>
              {% if forloop.last %}
              <input type="hidden" name="next" id="id_next" value="{% url 'users:detail' request.user.id %}">
              <input class="btn btn-primary" type="submit" value="Save Changes">
              {% endif %}
            {% endfor %}
            </form>
            {% endif %}
          </div>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            My Communities
          </div>
          <div class="">
            {% for facebook_group in groups %}
              {% include "facebook_groups/facebook_group_list_item.html" %}
            {% empty %}
            <div class="panel-body">
              <p>Your communities will appear here when you <a href="{% url 'facebook_groups:list' %}">join a community</a>.</p>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            Favorite {{ trainings.course_name }}s
          </div>
          <div class="">
            <div class="list-group lessons">
              {% for course_favourite in courses %}
                {% with course_favourite.course as course %}
                  {% include "courses/course_list_item.html" %}
                {% endwith %}
                {% empty %}
                <div class="panel-body">
                  <p>Your favorite courses will appear here when you <a href="{% url 'courses:list' %}">favorite a course</a>.</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            Favorite {{ trainings.lesson_name }}s
          </div>
          <div class="">
            <div class="list-group lessons">
              {% for lesson_favourite in lessons %}
                {% with lesson_favourite.lesson as lesson %}
                  {% include "lessons/lesson_list_item.html" %}
                {% endwith %}
                {% empty %}
                <div class="panel-body">
                  <p>Your favorite lessons will appear here when you <a href="{% url 'lessons:list' %}">favorite a lesson</a>.</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}
{% endblock content %}

{% block modal %}
<div class="bottom-menu visible-sm visible-xs">
  <div class="bottom-menu-trigger text-center">
    <a href="#" class="" id="bottom-menu-trigger">Download the free Decide To Fly &trade; mobile app</a>
  </div>
  <div class="bottom-menu-content" id="bottom-menu-content">
    <p class="text-center">Simply tap the <i class=""></i> button below, and choose<br>
      "Add to Home Screen"<br>
      The mobile app will appear installed as an icon on your homescreen.<br>
      <i class="fa fa-arrow-down"></i>
    </p>
  </div>
</div>

{% endblock modal %}

{% block javascript %}
{{ block.super }}
<script>
$(document).ready(function(){
  $('#bottom-menu-trigger').on('click', function(e) {
    e.preventDefault();
    $('#bottom-menu-content').toggleClass('active');
  });
if (window.navigator.standalone) {
    // The app is running in standalone mode.
    $('#bottom-menu-trigger').addClass('hidden');
}
});
</script>
<script src="{% static 'comments/dtfComments.js' %}"></script>
{% if etfar_form %}
<script src="{% static 'etfars/js/etfarTool.js' %}"></script>
{% endif %}
{% endblock javascript %}


