{% extends 'pages/base.html' %}
{% load staticfiles crispy_forms_tags query_string video_player thumbnail comments user_permission_tags markdown %}


{% block css %}
{{ block.super }}
<link href="{% static 'js/video-js/video-js.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static 'js/uploader/css/jquery.fileupload.css' %}">
<link rel="stylesheet" href="{% static 'js/uploader/css/jquery.fileupload-ui.css' %}">
{% endblock css %}
{% block javascript %}
{{ block.super }}
<script type="text/javascript" src="{% static 'js/uploader/js/jquery.fileupload.js' %}"></script>
<script type="text/javascript" src="{% static 'js/uploader/js/jquery.iframe-transport.js' %}"></script>
<script src="{% static 'js/audiojs/audio.min.js' %}"></script>
<script src="{% static 'js/video-js/video.js' %}"></script>
<script>
  videojs.options.flash.swf = "{% static 'js/video-js/video-js.swf' %}"
  audiojs.events.ready(function() {
    var as = audiojs.createAll();
  });

  </script>
{% endblock javascript %}


{% block content %}
{% if lesson %}
<section class="lesson-detail">
  <div class="container">

    <div class="section-header text-center">
      <h2 class="section-title">
        {% if request.user.is_authenticated %}
          <a href="{% url 'lessons:detail' slug=lesson.slug %}">{{ lesson.name }}</a></h2>
        {% else %}
          Sign Up for <a href="{% url 'account_signup' %}"><span>{{ course.name }}</span></a></h2>
        {% endif %}
      <h3 class="section-subtitle">{{ course.description }}</h3>
      {% if not resource_list and not homework_list %}<hr>{% endif %}
    </div>
    <div class="row">
      <div class="content{% if resource_list and homework_list %} col-sm-7{% else %} col-sm-12{% endif %}">

        {% if lesson.video %}
          {% if lesson.video.status == lesson.video.CONVERTED %}
            {% video_player lesson %}
          {% else %}
            <div class="jumbotron">
              <p class="text-center">
                {% if lesson.video.status == lesson.video.ERROR %}
                  Error uploading video file.
                {% else %}
                  This video is being processed.
                {% endif %}
              </p>  
            </div>
          {% endif %}
        {% else %}

            {% thumbnail lesson.thumbnail '1280x720' crop='center' as im %}
            <img src="{{ im.url }}" class="img-rounded img-responsive" alt="{{ lesson.name }}">
            {% endthumbnail %}

          {% if lesson.audio %}
          <p>
            <audio src="{{ lesson.audio.url }}" preload="auto" />
          </p>
          {% endif %}
        {% endif %}{# if lesson.video #}

    <div class="section-header text-center">
      <h2 class="section-title">
        {% if request.user.is_authenticated and lesson.slug %}
          <a href="{% url 'lessons:detail' slug=lesson.slug %}">{{ lesson.name }}</a></h2>
        {% else %}
          <a href="{% url 'account_signup' %}">{{ lesson.name }}</a></h2>
        {% endif %}
      <h3 class="section-subtitle"></h3>
      {% if not resource_list and not homework_list %}<hr>{% endif %}
    </div>
      <p class
      <p class="">
        {{ lesson.description|markdown }}
      </p>
      </div><!--/ .content-->
      
    </div><!--/ .row-->

  </div><!--/ .container-->

</section><!--/ .lesson-detail-->
{% endif %}
{% endblock content %}

