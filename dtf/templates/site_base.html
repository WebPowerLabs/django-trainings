{% extends 'base.html' %}
{% comment %}
This page is added to adapt to django-stripe-payments default
template structure. django-stripe-payments templates are found
in dtf/templates/payments/
{% endcomment %}

{% block content %}
<section class="section-payments">
  <div class="container">
    <div class="col-md-6 col-md-offset-3">
      {% block body %}{% endblock body %}
    </div>
  </div>
</section>
{% endblock content %}

{% block javascript %}
{{ block.super }}

<script src="//checkout.stripe.com/v2/checkout.js"></script>
<script>
    $(function() {
        $('body').on("click", '.change-card, .subscribe-form button[type=submit]', function(e) {
          e.preventDefault();
          var $form = $(this).closest("form"),
              token = function(res) {
                $form.find("input[name=stripe_token]").val(res.id);
                $form.trigger("submit");
              };

          StripeCheckout.open({
            key:         '{{ STRIPE_PUBLIC_KEY }}',
            name:        'Payment Method',
            panelLabel:  'Add Payment Method',
            token:       token
          });

          return false;
        });
    });
</script>
{% endblock javascript %}